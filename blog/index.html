<!DOCTYPE html><html><head><title>Handling Exceptions in Gearman Tasks (Even Background Ones) • Vance Lucas</title><link href="../stylesheets/application.css?1394393834" media="all" rel="stylesheet" type="text/css" /><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script><script src="../javascripts/application.js?1390519453" type="text/javascript"></script><link href="../images/favicon.ico" rel="shortcut icon" /><link href="http://vancelucas.com/feed.xml" rel="alternate" title="RSS" type="application/rss+xml" /><meta charset="utf-8" /><meta content="Personal website and blog of Vance Lucas from Oklahoma City, OK" name="description" /><meta content="Vance Lucas" name="apple-mobile-web-app-title" /><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="initial-scale=1.0, user-scalable=no" name="viewport" /></head><body class="blog blog_index"><header><div class="navbar-wrapper"><nav class="navbar navbar-inverse navbar-static-top" role="navigation"><div class="container"><div class="navbar-header"><button class="navbar-toggle" data-target="#nav-main-header" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Vance Lucas</a></div><div class="navbar-collapse collapse" id="nav-main-header"><ul class="nav navbar-nav"><li><a href="/blog">Blog</a></li><li><a href="/skills">Skills</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/contact">Contact</a></li></ul></div></div></nav></div></header><div class="container main"><div class="row"><div class="col-md-10 col-md-offset-1"><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/pulling-my-apps-from-the-app-store/">Pulling My Apps From The App Store</a> <small>May  1, 2014</small></h2></h2><p><img alt="Pulling My Apps From The App Store" src="../images/posts/2014/appstore/itunesconnect-unpublished-apps.png?1398985656"></p>

<p>Last night, I decided to pull my two iOS and Android apps <a href="/blog/android-iphone-seo-app/">SEMTab SEO
Pro</a> and my very first app, <a href="/blog/zero-to-app-in-two-weeks-with-titanium/">AutoRidge
Lite</a> from the App Store and
Google Play. It was a difficult decision to make, because they were my first
two apps, and I now have <em>no published...</em></p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/funemployed/">Funemployed</a> <small>Mar 20, 2014</small></h2></h2><p>After running <a href="http://brightbit.com">Brightbit</a> with <a href="http://joshuaogle.com">Joshua
Ogle</a> and <a href="http://ericboehs.com">Eric Boehs</a> for nearly
fours years, it officially came to an end a few weeks ago on February 28, 2014
when we closed the office. It’s a long story, and there is no blog post for it
yet, but now is not the...</p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/macbook-pro-retina-3-5mm-trrs-cable-with-audio-input/">MacBook Pro Retina 3.5mm TRRS Cable With Audio Input</a> <small>Mar  8, 2014</small></h2></h2><p>One of the unexpected surprises that came with upgrading to a new Macbook Pro
Retina 15" from an older MacBook Pro was Apple’s inexplicable deletion of
the audio input (mic) 3.5mm jack. I use a regularly use a gaming headset with a
boom mic that was...</p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/okcphp-user-group-reboot/">Oklahoma PHP User Group Reboot</a> <small>Mar  3, 2014</small></h2></h2><p>Our first <a href="http://oklahomaphp.com">Oklahoma PHP User Group</a> meeting in a few
years happened on Thursday, February 20th 2014, thanks to the efforts of <a href="http://jakeasmith.com">Jake
A. Smith</a> who contacted me about it (as I ran the
previous PHPUG a few years ago) and did all the legwork to make it happen...</p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/using-dokku-to-deploy-php-applications-on-digitalocean/">Using Dokku to Deploy PHP Applications with a "git push" on DigitalOcean</a> <small>Feb  8, 2014</small></h2></h2><p>Want a Platform-as-a-Service setup like <a href="http://heroku.com">Heroku</a> on your own
<a href="https://www.digitalocean.com/?refcode=b814bf3a4035">$5/month VPS from DigitalOcean</a>? Look no
further than
<a href="http://progrium.com/blog/2013/06/19/dokku-the-smallest-paas-implementation-youve-ever-seen/">Dokku</a>
- a set of scripts built on <a href="https://www.docker.io/">Docker</a> and Heroku’s own
buildpacks. After this setup, you’re just one <code>git push</code> away from deploying
your...</p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/skiphp-conference/">SkiPHP Conference 2014</a> <small>Jan 22, 2014</small></h2></h2><p>It’s always fun to be a part of a conference’s first year. This year, I was
lucky enough to speak at the inaugural <a href="http://skiphp.com">SkiPHP Conference</a>
in Salt Lake City, UT. Since the conference was very micro-framework friendly,
I was able to present my own <a href="http://bulletphp.com">Bullet...</a></p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/new-year-new-blog/">New Year, New Blog</a> <small>Jan  4, 2014</small></h2></h2><p>It’s a whole new year, and I’ve got a whole new blog. This time around, I knew
I wanted a static blog generator instead of a WordPress site (they are a little
more developer friendly, and there are no security vulnerabilities with static
HTML), and...</p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/valitron-the-simple-validation-library-that-doesnt-suck/">Valitron: The Simple Validation Library That Doesn't Suck</a> <small>Mar  4, 2013</small></h2></h2><p><a href="https://github.com/vlucas/valitron">Valitron</a> is a simple, minimal and elegant stand-alone PHP validation library with NO dependencies. Valitron uses simple, straightforward validation methods with a focus on readable and concise syntax.</p>

<h3>Why Another Validation Library?</h3>

<p><a href="https://github.com/vlucas/valitron">Valitron</a> was...</p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/introducing-bullet-the-functional-php-micro-framework/">Introducing Bullet: The Functional PHP Micro-Framework</a> <small>Dec 20, 2012</small></h2></h2><p><a href="http://bulletphp.com">Bullet</a> is a new PHP micro-framework with a unique
functional approach to URL routing that allows for more flexibility and
requires less verbosity than the more typical full route+callback approach
found in other micro-frameworks.</p>

<h3>The Problem with Independent Scope</h3>

<p>The main problem with most micro-frameworks and even full-stack MVC frameworks
that leads to code duplication is that the callback or method executed to
perform the action and respond to the URL route lives fully within its own
scope. This means that you are forced to repeat a lot of setup code across URL
route handlers that load the same resource, authorize it, etc.</p>

<p>Some typical micro-framework code might look like this:</p>
<pre class="highlight php"><span class="cp">&lt;?php</span>
<span class="c1">// View single post
</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/posts/:id&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="nx">check_user_acl_for</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
    <span class="c1">// ...
</span><span class="p">});</span>

<span class="c1">// Delete post
</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/posts/:id&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="nx">check_user_acl_for</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
    <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
    <span class="c1">// ...
</span><span class="p">});</span>

<span class="c1">// Edit post
</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/posts/:id/edit&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$post</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
    <span class="nx">check_user_acl_for</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
    <span class="c1">// ...
</span><span class="p">});</span>
</pre>
<p>You may be able to move the ACL check to a middleware layer or &ldquo;before&rdquo; hook if
the framework supports it, but there is always a certain amount of duplicate
code you will either never be able to get rid of, or have to jump through hoops
to get rid of (like adding more abstraction or re-checking the current URL,
etc).</p>

<h3>The Benefits of Shared Scope</h3>

<p>Bullet uses a unique nested callback style that splits the URL by directory
separator and only handles a single part of the URL at a time with it&rsquo;s own
callback. At first blush, this approach might seem like more work, but the key
to how Bullet works is that nested closures - by definition - can use variables
defined in the scope of their parent. This leads to some pretty powerful and
profund capabilities that can only be done using the same nested closure style
that Bullet uses.</p>

<p></div></div><div class="panel panel-default"><div class="panel-body"><h2><a href="/blog/handling-exceptions-in-gearman-tasks-even-background-ones/">Handling Exceptions in Gearman Tasks (Even Background Ones)</a> <small>Jul 31, 2012</small></h2></h2><p>I recently had some issues with Gearman tasks throwing exceptions and killing
the whole Gearman daemon. This made it nearly impossible to trace errors back
to their origin, because the logged exception stack trace didn’t provide much
useful information...</p></div></div><ul class="pager"><li class="next"><a href="/blog/page/2/">Next &rarr;</a></li></ul></div></div></div><footer id="page_foot"><div class="container"><section class="col-md-4"><h3></h3><img width="250" class="thumbnail" src="../images/VanceLucas-March09.jpg?1390519453" /><ul class="contact_icons"><li><a href="https://github.com/vlucas"><img src="../images/icons/Github.png?1390519453" /></a></li><li><a href="https://twitter.com/vlucas"><img src="../images/icons/Twitter.png?1390519453" /></a></li><li><a href="http://www.linkedin.com/in/vancelucas"><img src="../images/icons/LinkedIN.png?1390519453" /></a></li><li><a href="/feed.xml"><img src="../images/icons/RSS.png?1390519453" /></a></li></ul></section><section class="col-md-4"><h3>Sites & Projects</h3><div class="list-group"><a class="list-group-item" href="http://brightbit.com">Brightbit - App Development</a><a class="list-group-item" href="http://autoridge.com">Autoridge - Find Auto Parts</a><a class="list-group-item" href="http://invoicemore.com">InvoiceMore - Online Invoicing</a><a class="list-group-item" href="http://jscompress.com">Online JavaScript Compressor</a><a class="list-group-item" href="http://strfu.com">Online String Functions</a></div></section><section class="col-md-4"><h3>Recent Posts</h3><div class="list-group"><a class="list-group-item" href="/blog/pulling-my-apps-from-the-app-store/">Pulling My Apps From The App Store</a><a class="list-group-item" href="/blog/funemployed/">Funemployed</a><a class="list-group-item" href="/blog/macbook-pro-retina-3-5mm-trrs-cable-with-audio-input/">MacBook Pro Retina 3.5mm TRRS Cable With Audio Input</a><a class="list-group-item" href="/blog/okcphp-user-group-reboot/">Oklahoma PHP User Group Reboot</a><a class="list-group-item" href="/blog/using-dokku-to-deploy-php-applications-on-digitalocean/">Using Dokku to Deploy PHP Applications with a "git push" on DigitalOcean</a></div></section></div></footer><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-359731-12']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>